<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>LatLongDist.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tomasino</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptBracket/Brace">{</span>    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">adobe</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">StringUtil</span>;        <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">LatLongDist</span>    <span class="ActionScriptBracket/Brace">{</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> 6378137;            <span class="ActionScriptComment">// WGS-84 ellipsiod</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> 6356752.3142;        <span class="ActionScriptComment">// WGS-84 ellipsiod</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">=</span> 1<span class="ActionScriptOperator">/</span>298.257223563;    <span class="ActionScriptComment">// WGS-84 ellipsiod</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">R</span> <span class="ActionScriptOperator">=</span> 6371000; <span class="ActionScriptComment">// earth's mean radius in meters</span>                <span class="ActionScriptComment">/* All distances are in meters */</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">LatLongDist</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>        <span class="ActionScriptBracket/Brace">{</span>        <span class="ActionScriptBracket/Brace">}</span>                    <span class="ActionScriptComment">/*  Vincenty Inverse Solution of Geodesics on the Ellipsoid  */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">convertToDec</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">latlong</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">latlong</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">adobe</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">StringUtil</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">trim</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">latlong</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// trim whitespace off ends</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isNeg</span>:<span class="ActionScriptDefault_Text">Boolean</span>;            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">latlong</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toUpperCase</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">'S'</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">latlong</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toUpperCase</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">'W'</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">isNeg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;                        <span class="ActionScriptDefault_Text">latlong</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">latlong</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/[\−]/g</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'-'</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Wikipedia uses funky hyphens for minus signs</span>            <span class="ActionScriptDefault_Text">latlong</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">latlong</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/[^0-9\-\.]/g</span><span class="ActionScriptOperator">,</span><span class="ActionScriptString">' '</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Get rid of anything not a number or decimal place or negative</span>            <span class="ActionScriptDefault_Text">latlong</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">latlong</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/ {2,}/g</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">' '</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// condense whitespace</span>            <span class="ActionScriptDefault_Text">latlong</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">adobe</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">StringUtil</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">trim</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">latlong</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// trim whitespace off ends</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dms</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">latlong</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/ /</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// split</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">deg</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">isNeg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;                        <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>             <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptReserved">case</span> 3:                    <span class="ActionScriptDefault_Text">deg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 60 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3600;                     <span class="ActionScriptReserved">break</span>;                <span class="ActionScriptReserved">case</span> 2:                     <span class="ActionScriptDefault_Text">deg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 60;                     <span class="ActionScriptReserved">break</span>;                <span class="ActionScriptReserved">case</span> 1:                    <span class="ActionScriptDefault_Text">deg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dms</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;                    <span class="ActionScriptReserved">break</span>;                <span class="ActionScriptReserved">default</span>:                     <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">NaN</span>;            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isNeg</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">deg</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">deg</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span>1;            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">deg</span>;        <span class="ActionScriptBracket/Brace">}</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">vincenty</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lon1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lat2</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lon2</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>         <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lambda</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lon2</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">lon1</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lambda</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lambdaP</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">+</span> 1; <span class="ActionScriptComment">// So we can get past the first test</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">U1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tan</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">U2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tan</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinU1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">U1</span><span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosU1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">U1</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinU2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">U2</span><span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosU2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">U2</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">iterLimit</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 100;            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lambda</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">lambdaP</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;</span> 0.000000000001 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">iterLimit</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinLambda</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lambda</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosLambda</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lambda</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinSigma</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosU2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinLambda</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosU2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinLambda</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosU1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinU2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sinU1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosU2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosLambda</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosU1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinU2</span><span class="ActionScriptOperator">-</span>  <span class="ActionScriptDefault_Text">sinU1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosU2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosLambda</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sinSigma</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> 0;  <span class="ActionScriptComment">// co-incident points</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosSigma</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sinU1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinU2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosU1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosU2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosLambda</span>;                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sigma</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sinSigma</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cosSigma</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinAlpha</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cosU1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosU2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinLambda</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">sinSigma</span>;                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosSqAlpha</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sinAlpha</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinAlpha</span>;                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cos2SigmaM</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cosSigma</span> <span class="ActionScriptOperator">-</span> 2 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinU1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinU2</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">cosSqAlpha</span>;                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isNaN</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cos2SigmaM</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">cos2SigmaM</span> <span class="ActionScriptOperator">=</span> 0;  <span class="ActionScriptComment">// equatorial line: cosSqAlpha=0 (§6)</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">C</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">/</span> 16 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosSqAlpha</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>4 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>4 <span class="ActionScriptOperator">-</span> 3 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosSqAlpha</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptDefault_Text">lambdaP</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lambda</span>;                <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">C</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinAlpha</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sigma</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">C</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinSigma</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cos2SigmaM</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">C</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosSigma</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>1 <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos2SigmaM</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos2SigmaM</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iterLimit</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">NaN</span>  <span class="ActionScriptComment">// formula failed to converge</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uSq</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cosSqAlpha</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">A</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uSq</span> <span class="ActionScriptOperator">/</span> 16384 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>4096 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uSq</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>768 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uSq</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>320 <span class="ActionScriptOperator">-</span> 175 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">uSq</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">B</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uSq</span> <span class="ActionScriptOperator">/</span> 1024 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> 256 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uSq</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>128 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uSq</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>74 <span class="ActionScriptOperator">-</span> 47 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">uSq</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">deltaSigma</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">B</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinSigma</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cos2SigmaM</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">B</span> <span class="ActionScriptOperator">/</span> 4 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosSigma</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>1 <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos2SigmaM</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cos2SigmaM</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">B</span> <span class="ActionScriptOperator">/</span> 6 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos2SigmaM</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>3 <span class="ActionScriptOperator">+</span> 4 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinSigma</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinSigma</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>3 <span class="ActionScriptOperator">+</span> 4 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos2SigmaM</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos2SigmaM</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">A</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sigma</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">deltaSigma</span><span class="ActionScriptBracket/Brace">)</span>;                          <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">s</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">haversine</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lon1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lat2</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lon2</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dLat</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span>;          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dLon</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lon2</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">lon1</span><span class="ActionScriptBracket/Brace">)</span>;          <span class="ActionScriptDefault_Text">lat1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span>;          <span class="ActionScriptDefault_Text">lat2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span>;                  <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dLat</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dLat</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dLon</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dLon</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span>;          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 2 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">a</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">R</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;          <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">d</span>;                  <span class="ActionScriptBracket/Brace">}</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">cosinelaw</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lon1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lat2</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lon2</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">lat1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptDefault_Text">lat2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span>;                          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">acos</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lon2</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">lon1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">R</span>;              <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">d</span>;        <span class="ActionScriptBracket/Brace">}</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">bearing</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lon1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lat2</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lon2</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">lat1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span>;              <span class="ActionScriptDefault_Text">lat2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dLon</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lon2</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">lon1</span><span class="ActionScriptBracket/Brace">)</span>;                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dLon</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lat2</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dLon</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">toBrng</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toRad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>         <span class="ActionScriptBracket/Brace">{</span>          <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span> <span class="ActionScriptOperator">/</span> 180;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toDeg</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>          <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptOperator">*</span> 180 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toBrng</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toDeg</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 360 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">%</span> 360;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toDMS</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span><span class="ActionScriptBracket/Brace">)</span>;             <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">deg</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">floor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">min</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">floor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">deg</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>60<span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sec</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">round</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">deg</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">min</span><span class="ActionScriptOperator">/</span>60<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>3600<span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">'\u00B0'</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">min</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">'\''</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sec</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">'\"'</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toLat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">toDMS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> <span class="ActionScriptString">'S'</span> : <span class="ActionScriptString">'N'</span><span class="ActionScriptBracket/Brace">)</span>;  <span class="ActionScriptComment">// knock off initial '0' for lat!</span>        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toLon</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">toDMS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">?</span> <span class="ActionScriptString">'E'</span> : <span class="ActionScriptString">'W'</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>    <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
